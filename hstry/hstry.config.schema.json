{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "hstry config",
  "type": "object",
  "additionalProperties": false,
  "properties": {
    "database": {
      "type": "string",
      "description": "Path to the hstry database file."
    },
    "adapter_paths": {
      "type": "array",
      "items": { "type": "string" },
      "description": "Directories to search for adapters."
    },
    "js_runtime": {
      "type": "string",
      "enum": ["auto", "bun", "deno", "node"],
      "description": "Preferred JavaScript runtime."
    },
    "embedding_endpoint": {
      "type": ["string", "null"],
      "description": "Optional embedding endpoint."
    },
    "workspaces": {
      "type": "array",
      "items": { "type": "string" },
      "description": "Workspace roots to scan recursively."
    },
    "adapters": {
      "type": "array",
      "items": { "$ref": "#/definitions/AdapterConfig" }
    },
    "service": {
      "$ref": "#/definitions/ServiceConfig"
    },
    "sources": {
      "type": "array",
      "items": { "$ref": "#/definitions/SourceConfig" }
    },
    "remotes": {
      "type": "array",
      "items": { "$ref": "#/definitions/RemoteConfig" }
    },
    "search": {
      "$ref": "#/definitions/SearchConfig"
    }
  },
  "required": [
    "database",
    "adapter_paths",
    "js_runtime",
    "workspaces",
    "adapters",
    "service",
    "sources"
  ],
  "definitions": {
    "AdapterConfig": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "name": { "type": "string" },
        "enabled": { "type": "boolean", "default": true }
      },
      "required": ["name"]
    },
    "ServiceConfig": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "enabled": { "type": "boolean", "default": false },
        "poll_interval_secs": { "type": "integer", "minimum": 1, "default": 30 },
        "search_api": { "type": "boolean", "default": true },
        "search_port": { "type": ["integer", "null"], "minimum": 1, "maximum": 65535 }
      },
      "required": ["enabled", "poll_interval_secs"]
    },
    "SourceConfig": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "id": { "type": "string" },
        "adapter": { "type": "string" },
        "path": { "type": "string" },
        "auto_sync": { "type": "boolean", "default": true }
      },
      "required": ["id", "adapter", "path"]
    },
    "RemoteConfig": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "name": { "type": "string" },
        "host": { "type": "string" },
        "database_path": { "type": ["string", "null"] },
        "port": { "type": ["integer", "null"] },
        "identity_file": { "type": ["string", "null"] },
        "enabled": { "type": "boolean", "default": true }
      },
      "required": ["name", "host"]
    },
    "SearchConfig": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "index_path": { "type": ["string", "null"] },
        "index_batch_size": { "type": "integer", "minimum": 1, "default": 500 }
      }
    }
  }
}
